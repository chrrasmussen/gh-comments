<style>
    #gh-comments {
        font-size: 18px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }

    #gh-comments * {
        box-sizing: border-box;
    }

    #gh-comments > header {
        padding: 15px 0;
        border-bottom: 1px solid #d1d5da;
    }

    #gh-comments .leave-comment {
        line-height: 26px;
        float: right;
        text-decoration: none;
        color: #007ace;
    }

    .gh-c {
        color: #333;
        font-size: 14px;
        line-height: 1.5;
        overflow: auto;
        margin-top: 20px;
    }

    .gh-c > * {
        float: left;
    }

    .gh-c img {
        display: block;
        width: 44px;
        height: 44px;
        border-radius: 3px;
        margin-right: 16px;
    }

    .gh-c article {
        border: 1px solid #d1d5da;
        width: calc(100% - 60px);
        border-radius: 3px;
        position: relative;
    }

    .gh-c header {
        border-radius: 3px 3px 0 0;
        color: #777;
        padding: 10px 15px;
        background-color: #f6f8fa;
        border-bottom: 1px solid #d1d5da;
    }

    .gh-c header::before {
        width: 10px;
        height: 10px;
        background: #f6f8fa;
        border: 1px solid #d1d5da;
        position: absolute;
        content: "";
        top: 14px;
        left: -4px;
        transform: rotate(45deg);
        -webkit-clip-path: inset(4px 4px 0 0);
        clip-path: inset(4px 4px 0 0);
    }

    .gh-c main {
        padding: 15px;
    }

    .gh-c main > *:first-child {
        margin-top: 0 !important;
    }

    .gh-c main > *:last-child {
        margin-bottom: 0 !important;
    }

    .gh-c a {
        color: #656565;
        text-decoration: none;
        font-weight: 700;
    }

    .gh-c code {
        padding: 1px 3px;
        font-size: 85%;
        background-color: #f3f3f3;
        border-radius: 3px;
    }

    .gh-c pre {
        padding: 16px;
        background-color: #f6f8fa;
        border-radius: 3px;
        overflow-x: auto;
    }

    .gh-c pre code {
        background: #f6f8fa;
    }

    .gh-c blockquote {
        margin: 15px 0;
        padding: 0 1em;
        color: #6a737d;
        border-left: 0.25em solid #dfe2e5;
    }

    .gh-c blockquote > :first-child {
        margin-top: 0;
    }

    .gh-c blockquote > :last-child {
        margin-bottom: 0;
    }
</style>
<script type="text/javascript">
    function ghc(config) {
        let apiUrl = `https://api.github.com/repos/${config.user}/${config.repo}/issues/${config.commentIssue}/comments`;
        let webUrl = `https://github.com/${config.user}/${config.repo}/issues/${config.commentIssue}`;
        let pluralize = length => length !== 1 ? "s" : "";
        let request = new XMLHttpRequest();
        request.open("GET", apiUrl, true);
        request.setRequestHeader("Accept", "application/vnd.github.v3.html+json");
        request.onload = function () {
            let commentArea = document.getElementById("gh-comments");
            if (request.status === 200) {
                let comments = JSON.parse(request.responseText);
                commentArea.insertAdjacentHTML("beforeEnd",
                    `<header>
                        ${comments.length} comment${pluralize(comments.length)} <small>(via GitHub) <a href="${webUrl}" class="leave-comment">Leave a comment</a></small>
                    </header>`
                );
                comments.forEach(c => {
                    console.log(c);
                    let edited = c.created_at !== c.updated_at ? "â€¢ edited" : "";
                    commentArea.insertAdjacentHTML("beforeEnd",
                        `<div class="gh-c">
                        <img src="${c.user.avatar_url}">
                        <article>
                            <header>
                                <a href="${c.user.html_url}">${c.user.login}</a> commented ${timeSince(c.created_at)}
                                ${edited}
                            </header>
                            <main>${c.body_html}</main>
                        </article>
                    </div>`
                    );
                })
                ;
            } else {
                commentArea.insertAdjacentHTML("beforeEnd", "Failed to load comments");
            }
        };
        request.send();
        function timeSince(dateString) {
            let seconds = Math.floor((new Date() - new Date(dateString)) / 1000);
            let s = [31536000, 2592000, 86400, 3600, 60, 1];
            let p = ["year", "month", "day", "hour", "minute", "second"];
            for (let i = 0; i < 6; i++) {
                let interval = Math.round(seconds / s[i]);
                if (interval > 0) {
                    return `${interval} ${p[i]}${pluralize(interval)} ago`;
                }
            }
        }
    }
</script>

<body>
    <div id="gh-comments">
        <script>
            ghc({
                "user": "tipsy",
                "repo": "gh-comments",
                "commentIssue": 1
            });
        </script>
    </div>
</body>
